@page "/"
@using ChibiCSharpCompiler
@using System.Net
@rendermode InteractiveServer

<PageTitle>Home</PageTitle>

<div>
    <ul>
        <li>
            <a href="https://www.sigbus.info/compilerbook#%E3%82%B9%E3%83%86%E3%83%83%E3%83%975%E5%9B%9B%E5%89%87%E6%BC%94%E7%AE%97%E3%81%AE%E3%81%A7%E3%81%8D%E3%82%8B%E8%A8%80%E8%AA%9E%E3%81%AE%E4%BD%9C%E6%88%90">
                ステップ5：四則演算のできる言語の作成
            </a>
        </li>
    </ul>
    <div class="code">
        <p>コード</p>
        <textarea @oninput="OnInputChange"></textarea>
    </div>
    <p>↓</p>
    <div class="compile">
        <p>アセンブリ</p>
        <pre class="border">
            @(Assembly)
        </pre>
    </div>
    <div class="run">
        <button @onclick="OnClickRun">ilasm.exeして実行</button>
        <div class="border">
            @(ExeResult)
        </div>
    </div>
    <div>
        <ul>
            <li><s>ステップ4：エラーメッセージを改良</s></li>
            <li><s>ステップ3：トークナイザを導入</s></li>
            <li><s>ステップ2：加減算のできるコンパイラの作成</s></li>
            <li><s>ステップ1：整数1個をコンパイルする言語の作成</s></li>
        </ul>
    </div>
</div>


@code {
    private string Context { get; set; } = "";
    private string Assembly = "";
    private string ExeResult = "";

    private void OnInputChange(ChangeEventArgs e)
    {
        Context = e.Value?.ToString() ?? "";
        Assembly = WebUtility.HtmlEncode(Compiler.Compile(Context));
    }

    private void OnClickRun()
    {
        ExeResult = Executer.Run(Context, Assembly);
    }
}